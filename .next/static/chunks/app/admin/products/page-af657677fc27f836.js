(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[575],{82:(e,t,a)=>{Promise.resolve().then(a.bind(a,6165)),Promise.resolve().then(a.bind(a,9765))},1834:(e,t,a)=>{"use strict";a.d(t,{z:()=>r});var i=a(63);function r(){let e=(0,i.usePathname)()||"/",t=(0,i.useSearchParams)();return{pathname:e,search:(null==t?void 0:t.toString())?"?".concat(t.toString()):""}}},4975:(e,t,a)=>{"use strict";a.d(t,{F:()=>n});let i=String("https://ecom-backend-rql0.onrender.com").replace(/\/$/,"");async function r(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};try{let a=await fetch(e,{...t,credentials:"include"}),i=await a.text(),r={};try{r=i?JSON.parse(i):{}}catch(e){r={ok:!1,message:i||"Non-JSON response"}}return a.ok||!r||"object"!=typeof r||"status"in r||(r.status=a.status),r}catch(e){return{ok:!1,message:(null==e?void 0:e.message)||"Network error"}}}let n={BASE:i,get:e=>r("".concat(i).concat(e),{method:"GET"}),getAuth:(e,t)=>r("".concat(i).concat(e),{method:"GET",headers:t?{Authorization:"Bearer ".concat(t)}:{}}),post:(e,t,a)=>r("".concat(i).concat(e),{method:"POST",headers:{"Content-Type":"application/json",...a?{Authorization:"Bearer ".concat(a)}:{}},body:JSON.stringify(t||{})}),postForm:(e,t,a)=>r("".concat(i).concat(e),{method:"POST",headers:{...a?{Authorization:"Bearer ".concat(a)}:{}},body:t}),postAuth:(e,t,a)=>r("".concat(i).concat(e),{method:"POST",headers:{"Content-Type":"application/json",...t?{Authorization:"Bearer ".concat(t)}:{}},body:JSON.stringify(a||{})}),put:(e,t,a)=>r("".concat(i).concat(e),{method:"PUT",headers:{"Content-Type":"application/json",...a?{Authorization:"Bearer ".concat(a)}:{}},body:JSON.stringify(t||{})}),putAuth:(e,t,a)=>r("".concat(i).concat(e),{method:"PUT",headers:{"Content-Type":"application/json",...t?{Authorization:"Bearer ".concat(t)}:{}},body:JSON.stringify(a||{})}),delete:(e,t)=>r("".concat(i).concat(e),{method:"DELETE",headers:t?{Authorization:"Bearer ".concat(t)}:{}}),token:function(){return localStorage.getItem("token")||""},adminToken:function(){return localStorage.getItem("admin_token")||""}}},6165:(e,t,a)=>{"use strict";a.d(t,{default:()=>o});var i=a(5155),r=a(2115),n=a(6848),l=a(1834),s=a(4975);function o(e){let{children:t}=e;(0,l.z)();let[a,o]=(0,r.useState)(null);return((0,r.useEffect)(()=>{let e=localStorage.getItem("admin_token")||"";if(!e)return void o(!1);(async()=>{try{let t=await s.F.getAuth("/api/admin-auth/me",e);(null==t?void 0:t.ok)?o(!0):o(!1)}catch(e){o(!1)}})()},[]),null===a)?(0,i.jsx)("div",{style:{padding:20,fontSize:16},children:"Checking admin..."}):a?t:(0,i.jsx)(n.A,{to:"/admin/login",replace:!0})}},6848:(e,t,a)=>{"use strict";a.d(t,{A:()=>n});var i=a(2115),r=a(63);function n(e){let{to:t="/",replace:a=!1}=e,n=(0,r.useRouter)();return(0,i.useEffect)(()=>{a?n.replace(t):n.push(t)},[t,a,n]),null}},9109:(e,t,a)=>{"use strict";a.d(t,{A:()=>l});var i=a(5155),r=a(2619),n=a.n(r);function l(e){var t;let{to:a,href:r,...l}=e;return(0,i.jsx)(n(),{href:null!=(t=null!=r?r:a)?t:"#",...l})}},9765:(e,t,a)=>{"use strict";a.d(t,{default:()=>c});var i=a(5155),r=a(2115),n=a(4975),l=a(6165),s=a(9109);function o(){var e,t;let a=(0,r.useRef)(null),[l,o]=(0,r.useState)([]),[c,d]=(0,r.useState)([]),[u,m]=(0,r.useState)(!1),[p,g]=(0,r.useState)(!1),[h,v]=(0,r.useState)({id:"",title:"",category:"",price:0,compareAtPrice:0,images:[],description:"",variants:"Pink & Blue:4"}),y=async()=>{let e=await n.F.get("/api/categories");(null==e?void 0:e.ok)&&(o(e.categories||[]),v(t=>{var a,i;return{...t,category:t.category||(null==(i=e.categories)||null==(a=i[0])?void 0:a._id)||""}}));let t=await n.F.get("/api/products");(null==t?void 0:t.ok)&&d(t.products||[])};(0,r.useEffect)(()=>{y()},[]);let f=async e=>{var t;let i=Array.from(e||[]);if(!i.length)return;let r=5-((null==(t=h.images)?void 0:t.length)||0);if(r<=0){alert("Max 5 images already added"),a.current&&(a.current.value="");return}let l=i.slice(0,r);m(!0);let s=new FormData;for(let e of l)s.append("images",e);try{let e=n.F.adminToken(),t=await fetch("".concat(n.F.BASE,"/api/admin/upload/product-images"),{method:"POST",headers:{Authorization:"Bearer ".concat(e)},body:s}),a=await t.text(),i={};try{i=a?JSON.parse(a):{}}catch(e){i={ok:!1,message:a||"Non-JSON response"}}if(!(null==i?void 0:i.ok))return void alert((null==i?void 0:i.message)||"Upload failed");let r=Array.isArray(i.images)?i.images:[];v(e=>({...e,images:[...e.images||[],...r].slice(0,5)}))}catch(e){alert((null==e?void 0:e.message)?"Upload error: ".concat(e.message):"Upload error")}finally{m(!1),a.current&&(a.current.value="")}},x=()=>{v(e=>({...e,id:"",title:"",price:0,compareAtPrice:0,images:[],description:"",variants:"Pink & Blue:4"})),a.current&&(a.current.value="")},b=async()=>{var e;if(u)return alert("Please wait for upload to finish");if(!String(h.title||"").trim())return alert("Title required");if(!h.category)return alert("Category required");if(0>=Number(h.price))return alert("Price required");if(!(null==(e=h.images)?void 0:e.length))return alert("Please upload at least 1 image");g(!0);try{let e={title:String(h.title||"").trim(),category:h.category,price:Number(h.price||0),compareAtPrice:Number(h.compareAtPrice||0),images:h.images||[],description:h.description||"",variants:String(h.variants||"").split(",").map(e=>e.trim()).filter(Boolean).map(e=>{let[t,a]=e.split(":");return{name:(t||"").trim(),stock:Number(a||0)}}).filter(e=>e.name)},t=n.F.adminToken();if(h.id){let a=await n.F.put("/api/admin/products/".concat(h.id),e,t);if(!(null==a?void 0:a.ok))return alert((null==a?void 0:a.message)||"Update failed");alert("✅ Product updated")}else{let a=await n.F.post("/api/admin/products",e,t);if(!(null==a?void 0:a.ok))return alert((null==a?void 0:a.message)||"Add failed");alert("✅ Product added")}x(),y()}finally{g(!1)}},j=async e=>{if(!window.confirm("Delete this product?"))return;let t=n.F.adminToken(),a=await n.F.delete("/api/admin/products/".concat(e),t);if(!(null==a?void 0:a.ok))return alert((null==a?void 0:a.message)||"Delete failed");alert("✅ Deleted"),y(),h.id===e&&x()};return(0,i.jsxs)("div",{className:"container",children:[(0,i.jsxs)("div",{className:"rowBetween",children:[(0,i.jsx)("h2",{children:"Admin Products"}),(0,i.jsx)(s.A,{className:"btnGhost",to:"/admin",children:"← Back"})]}),(0,i.jsxs)("div",{className:"box",children:[(0,i.jsxs)("div",{className:"rowBetween",style:{gap:12},children:[(0,i.jsx)("b",{children:h.id?"Edit Product":"Add Product"}),h.id?(0,i.jsx)("button",{className:"btnGhost",type:"button",onClick:x,disabled:u||p,children:"Cancel Edit"}):null]}),(0,i.jsx)("label",{className:"lbl",children:"Title"}),(0,i.jsx)("input",{className:"input",value:h.title,onChange:e=>v({...h,title:e.target.value})}),(0,i.jsx)("label",{className:"lbl",children:"Category"}),(0,i.jsx)("select",{className:"input",value:h.category,onChange:e=>v({...h,category:e.target.value}),children:l.map(e=>(0,i.jsx)("option",{value:e._id,children:e.name},e._id))}),(0,i.jsxs)("div",{className:"twoCol",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{className:"lbl",children:"Price"}),(0,i.jsx)("input",{className:"input",type:"number",inputMode:"numeric",value:h.price,onChange:e=>v({...h,price:e.target.value})})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{className:"lbl",children:"Compare At"}),(0,i.jsx)("input",{className:"input",type:"number",inputMode:"numeric",value:h.compareAtPrice,onChange:e=>v({...h,compareAtPrice:e.target.value})})]})]}),(0,i.jsxs)("label",{className:"lbl",children:["Product Images (Max 5) — এখন আছে: ",(null==(e=h.images)?void 0:e.length)||0,"/5"]}),(0,i.jsx)("input",{ref:a,type:"file",multiple:!0,accept:"image/*",disabled:u,onChange:e=>f(e.target.files)}),u?(0,i.jsx)("div",{className:"muted",children:"Uploading images..."}):null,(null==(t=h.images)?void 0:t.length)?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("div",{style:{display:"flex",gap:10,flexWrap:"wrap",marginTop:10},children:h.images.map((e,t)=>(0,i.jsxs)("div",{style:{position:"relative"},children:[(0,i.jsx)("img",{src:e,alt:"",style:{width:110,height:110,objectFit:"cover",borderRadius:10,border:"1px solid #eee",display:"block"}}),(0,i.jsx)("button",{type:"button",onClick:()=>{v(e=>({...e,images:(e.images||[]).filter((e,a)=>a!==t)}))},style:{position:"absolute",top:-8,right:-8,borderRadius:999,border:"none",padding:"4px 8px",cursor:"pointer",lineHeight:1},title:"Remove",children:"✕"})]},t))}),(0,i.jsx)("button",{type:"button",className:"btnGhost",onClick:()=>{v(e=>({...e,images:[]})),a.current&&(a.current.value="")},style:{marginTop:10},disabled:u,children:"Clear all images"})]}):(0,i.jsx)("div",{className:"muted",style:{marginTop:6},children:"No images uploaded yet"}),(0,i.jsx)("label",{className:"lbl",children:"Variants (format: Name:Stock,Name2:Stock2)"}),(0,i.jsx)("input",{className:"input",value:h.variants,onChange:e=>v({...h,variants:e.target.value})}),(0,i.jsx)("label",{className:"lbl",children:"Description"}),(0,i.jsx)("textarea",{className:"input",rows:3,value:h.description,onChange:e=>v({...h,description:e.target.value})}),(0,i.jsx)("button",{className:"btnPinkFull",onClick:b,disabled:u||p,children:u?"Uploading...":p?"Saving...":h.id?"Update Product":"Add Product"})]}),(0,i.jsx)("div",{className:"grid",children:c.map(e=>{var t,r;return(0,i.jsxs)("div",{className:"card",children:[(0,i.jsx)("img",{className:"cardImg",src:(null==(t=e.images)?void 0:t[0])||"https://via.placeholder.com/400x300?text=Product",alt:""}),(0,i.jsxs)("div",{className:"cardBody",children:[(0,i.jsx)("div",{className:"cardTitle",children:e.title}),(0,i.jsx)("div",{className:"muted",children:(null==(r=e.category)?void 0:r.name)||""}),(0,i.jsx)("div",{className:"priceRow",children:(0,i.jsxs)("span",{className:"price",children:["৳ ",e.price]})}),(0,i.jsxs)("div",{style:{display:"flex",gap:10,marginTop:10},children:[(0,i.jsx)("button",{className:"btnGhost",type:"button",onClick:()=>{var t;v({id:e._id,title:e.title||"",category:(null==(t=e.category)?void 0:t._id)||e.category||"",price:e.price||0,compareAtPrice:e.compareAtPrice||0,images:Array.isArray(e.images)?e.images:[],description:e.description||"",variants:Array.isArray(e.variants)&&e.variants.length?e.variants.map(e=>"".concat(e.name,":").concat(e.stock)).join(","):"Pink & Blue:4"}),window.scrollTo({top:0,behavior:"smooth"}),a.current&&(a.current.value="")},children:"Edit"}),(0,i.jsx)("button",{className:"btnDark",type:"button",onClick:()=>j(e._id),children:"Delete"})]})]})]},e._id)})})]})}function c(){return(0,i.jsx)(l.default,{children:(0,i.jsx)(o,{})})}}},e=>{e.O(0,[176,441,493,358],()=>e(e.s=82)),_N_E=e.O()}]);