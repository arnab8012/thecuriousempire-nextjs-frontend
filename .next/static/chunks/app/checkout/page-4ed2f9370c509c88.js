(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[279],{63:(e,s,t)=>{"use strict";var l=t(7260);t.o(l,"useParams")&&t.d(s,{useParams:function(){return l.useParams}}),t.o(l,"usePathname")&&t.d(s,{usePathname:function(){return l.usePathname}}),t.o(l,"useRouter")&&t.d(s,{useRouter:function(){return l.useRouter}}),t.o(l,"useSearchParams")&&t.d(s,{useSearchParams:function(){return l.useSearchParams}})},1789:(e,s,t)=>{"use strict";t.d(s,{default:()=>d});var l=t(5155),i=t(6848),n=t(1834),a=t(4901),r=t(4975);function d(e){let{children:s}=e,{user:t,booting:d}=(0,a.A)();return((0,n.z)(),d)?(0,l.jsx)("div",{className:"softBox",children:"Loading..."}):r.F.token()&&t?s:(0,l.jsx)(i.A,{to:"/login",replace:!0})}},1834:(e,s,t)=>{"use strict";t.d(s,{z:()=>i});var l=t(63);function i(){let e=(0,l.usePathname)()||"/",s=(0,l.useSearchParams)();return{pathname:e,search:(null==s?void 0:s.toString())?"?".concat(s.toString()):""}}},6848:(e,s,t)=>{"use strict";t.d(s,{A:()=>n});var l=t(2115),i=t(63);function n(e){let{to:s="/",replace:t=!1}=e,n=(0,i.useRouter)();return(0,l.useEffect)(()=>{t?n.replace(s):n.push(s)},[s,t,n]),null}},8482:(e,s,t)=>{Promise.resolve().then(t.bind(t,1789)),Promise.resolve().then(t.bind(t,9672))},9672:(e,s,t)=>{"use strict";t.d(s,{default:()=>v});var l=t(5155),i=t(2115),n=t(63),a=t(5167),r=t(4901),d=t(4975),o=t(9954);let u=["Dhaka","Chattogram","Rajshahi","Khulna","Barishal","Sylhet","Rangpur","Mymensingh"],c="shipping_book_v1";function h(e){return{fullName:(null==e?void 0:e.fullName)||"",phone1:(null==e?void 0:e.phone)||"",phone2:"",division:"Dhaka",district:"",upazila:"",addressLine:"",note:""}}function m(e){let s=[e.fullName,e.phone1,e.division,e.district,e.upazila,e.addressLine].filter(Boolean).join(" | ");return s.length>80?s.slice(0,80)+"...":s||"Address"}function p(){try{let e=function(e,s){try{return JSON.parse(e)}catch(e){return s}}(window.localStorage.getItem(c)||"{}",{});return{selectedId:(null==e?void 0:e.selectedId)||"",items:Array.isArray(null==e?void 0:e.items)?e.items:[]}}catch(e){return{selectedId:"",items:[]}}}function v(){var e,s,t;(0,o.A)("noindex, nofollow");let v=(0,n.useRouter)(),g=(0,n.useSearchParams)(),f=(null==g?void 0:g.get("mode"))==="buy",{items:b,clear:x,checkoutItem:N,clearBuyNow:j}=(0,a._)(),{user:y}=(0,r.A)(),w=d.F.token(),S=async e=>w?await d.F.putAuth("/api/auth/me",w,{shippingAddress:e}):{ok:!1,message:"No token"},[A,C]=(0,i.useState)({selectedId:"",items:[]}),[k,D]=(0,i.useState)(!1),[P,I]=(0,i.useState)(""),[B,O]=(0,i.useState)(h(y)),[q,T]=(0,i.useState)("COD"),_=(0,i.useMemo)(()=>f?N?[N]:[]:Array.isArray(b)?b:[],[f,b,N]),E=(0,i.useMemo)(()=>_.reduce((e,s)=>e+Number(s.price||0)*Number(s.qty||0),0),[_]),L=()=>B.fullName?B.phone1?B.division?B.district?B.upazila?B.addressLine?"":"Address required":"Upazila/Thana required":"District required":"Division required":"Phone required":"Name required",R=e=>{let s=p();if(!k&&P){let t=s.items.map(s=>s.id===P?{...s,shipping:e,label:s.label||m(e)}:s),l={...s,selectedId:P,items:t};window.localStorage.setItem(c,JSON.stringify(l)),C(l);return}let t=Math.random().toString(16).slice(2)+Date.now().toString(16),l=[{id:t,label:m(e),shipping:e},...s.items||[]],i={selectedId:t,items:l};window.localStorage.setItem(c,JSON.stringify(i)),C(i),I(t),D(!1)};if((0,i.useEffect)(()=>{var e,s;let t=p();C(t);let l=t.selectedId||(null==(s=t.items)||null==(e=s[0])?void 0:e.id)||"";if(I(l),!l)return void((null==y?void 0:y.shippingAddress)&&Object.keys(y.shippingAddress).length>0?(D(!1),O({...h(y),...y.shippingAddress})):(D(!0),O(h(y))));let i=t.items.find(e=>e.id===l);(null==i?void 0:i.shipping)?(D(!1),O({...h(y),...i.shipping})):(D(!0),O(h(y)))},[null==y?void 0:y.id]),(0,i.useEffect)(()=>{if(k)return;let e=A.items.find(e=>e.id===P);(null==e?void 0:e.shipping)&&O({...h(y),...e.shipping})},[P,k,null==(e=A.items)?void 0:e.length,null==y?void 0:y.id]),!_.length)return(0,l.jsxs)("div",{className:"container",children:["No item selected"," ",(0,l.jsx)("button",{className:"btnGhost",type:"button",onClick:()=>v.push("/shop"),children:"Go shop"})]});let z=async()=>{if(!w)return void v.push("/login");let e=L();if(e)return alert(e);let s=await S(B);if(!(null==s?void 0:s.ok))return alert((null==s?void 0:s.message)||"Address DB save failed");R(B);let t={items:_.map(e=>({productId:e.productId,qty:e.qty,variant:e.variant})),shipping:B,paymentMethod:q},l=await d.F.post("/api/orders",t,w);if(!(null==l?void 0:l.ok))return alert((null==l?void 0:l.message)||"Order failed");f?null==j||j():null==x||x(),alert("✅ Order placed!"),v.push("/profile")};return(0,l.jsxs)("div",{className:"container",children:[(0,l.jsx)("h2",{children:"Shipping Details"}),(null==(s=A.items)?void 0:s.length)>0&&(0,l.jsxs)("div",{className:"box",style:{marginBottom:14},children:[(0,l.jsxs)("div",{className:"rowBetween",children:[(0,l.jsx)("b",{children:"Saved Addresses"}),(0,l.jsx)("button",{type:"button",className:"btnGhost",onClick:()=>{D(!0),O(h(y))},children:"+ New Shipping Details"})]}),!k&&(0,l.jsx)("div",{style:{marginTop:10},children:A.items.map(e=>(0,l.jsxs)("div",{className:"rowBetween",style:{padding:"8px 10px",border:"1px solid #eee",borderRadius:8,marginBottom:8,background:P===e.id?"#f7f7ff":"#fff"},children:[(0,l.jsxs)("label",{style:{cursor:"pointer",flex:1},children:[(0,l.jsx)("input",{type:"radio",checked:P===e.id,onChange:()=>I(e.id),style:{marginRight:8}}),e.label]}),(0,l.jsx)("button",{type:"button",className:"btnGhost",style:{color:"crimson",borderColor:"#ffd6d6"},onClick:()=>{confirm("Delete this address?")&&(e=>{var s;let t=p(),l=(t.items||[]).filter(s=>s.id!==e),i=t.selectedId===e?(null==(s=l[0])?void 0:s.id)||"":t.selectedId,n={selectedId:i,items:l};if(window.localStorage.setItem(c,JSON.stringify(n)),C(n),I(i),i){D(!1);let e=l.find(e=>e.id===i);(null==e?void 0:e.shipping)&&O({...h(y),...e.shipping})}else D(!0),O(h(y))})(e.id)},children:"\uD83D\uDDD1 Delete"})]},e.id))}),k&&(0,l.jsx)("div",{className:"muted",style:{marginTop:10},children:"New address mode — নিচে নতুন ঠিকানা লিখে “Save & Use” করো"})]}),(0,l.jsxs)("div",{className:"box",children:[(0,l.jsx)("label",{className:"lbl",children:"আপনার নাম"}),(0,l.jsx)("input",{className:"input",value:B.fullName,onChange:e=>O({...B,fullName:e.target.value})}),(0,l.jsx)("label",{className:"lbl",children:"মোবাইল নাম্বার"}),(0,l.jsx)("input",{className:"input",value:B.phone1,onChange:e=>O({...B,phone1:e.target.value})}),(0,l.jsx)("label",{className:"lbl",children:"মোবাইল নাম্বার 2 (optional)"}),(0,l.jsx)("input",{className:"input",value:B.phone2,onChange:e=>O({...B,phone2:e.target.value})}),(0,l.jsx)("label",{className:"lbl",children:"বিভাগ"}),(0,l.jsx)("select",{className:"input",value:B.division,onChange:e=>O({...B,division:e.target.value}),children:u.map(e=>(0,l.jsx)("option",{value:e,children:e},e))}),(0,l.jsx)("label",{className:"lbl",children:"জেলা"}),(0,l.jsx)("input",{className:"input",value:B.district,onChange:e=>O({...B,district:e.target.value})}),(0,l.jsx)("label",{className:"lbl",children:"উপজেলা/থানা"}),(0,l.jsx)("input",{className:"input",value:B.upazila,onChange:e=>O({...B,upazila:e.target.value})}),(0,l.jsx)("label",{className:"lbl",children:"সম্পূর্ণ ঠিকানা (থানা সহ লিখে দিবেন)"}),(0,l.jsx)("input",{className:"input",value:B.addressLine,onChange:e=>O({...B,addressLine:e.target.value})}),(0,l.jsx)("label",{className:"lbl",children:"অর্ডার নোট (Optional)"}),(0,l.jsx)("textarea",{className:"input",rows:3,value:B.note,onChange:e=>O({...B,note:e.target.value})}),(0,l.jsxs)("div",{className:"rowBetween",style:{marginTop:10},children:[(0,l.jsx)("button",{type:"button",className:"btnGhost",onClick:async()=>{let e=L();if(e)return alert(e);let s=await S(B);if(!(null==s?void 0:s.ok))return alert((null==s?void 0:s.message)||"Address DB save failed");R(B),alert("✅ Address saved!")},children:"Save & Use"}),(null==(t=A.items)?void 0:t.length)>0&&(0,l.jsx)("button",{type:"button",className:"btnGhost",onClick:()=>{var e,s;D(!1);let t=A.selectedId||(null==(s=A.items)||null==(e=s[0])?void 0:e.id)||"";I(t);let l=A.items.find(e=>e.id===t);(null==l?void 0:l.shipping)&&O({...h(y),...l.shipping})},children:"Use Saved Address"})]}),(0,l.jsxs)("div",{className:"box",style:{marginTop:12},children:[(0,l.jsxs)("div",{className:"rowBetween",children:[(0,l.jsx)("span",{children:"Sub Total:"}),(0,l.jsxs)("b",{children:["৳ ",E]})]}),(0,l.jsxs)("div",{className:"rowBetween",children:[(0,l.jsx)("span",{children:"Delivery Charge:"}),(0,l.jsxs)("b",{children:["৳ ",110]})]}),(0,l.jsxs)("div",{className:"rowBetween",children:[(0,l.jsx)("span",{children:"Total:"}),(0,l.jsxs)("b",{children:["৳ ",E+110]})]})]}),(0,l.jsxs)("div",{className:"rowBetween",style:{marginTop:10},children:[(0,l.jsxs)("label",{className:"radio",children:[(0,l.jsx)("input",{type:"radio",checked:"FULL_PAYMENT"===q,onChange:()=>T("FULL_PAYMENT")}),"Full Payment"]}),(0,l.jsxs)("label",{className:"radio",children:[(0,l.jsx)("input",{type:"radio",checked:"COD"===q,onChange:()=>T("COD")}),"Cash On Delivery"]})]}),(0,l.jsx)("button",{className:"btnPinkFull",onClick:z,style:{marginTop:12},children:"অর্ডার নিশ্চিত করুন"})]})]})}},9954:(e,s,t)=>{"use strict";t.d(s,{A:()=>i});var l=t(2115);function i(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"noindex, nofollow";(0,l.useEffect)(()=>{let s=document.querySelector('meta[name="robots"]'),t=(null==s?void 0:s.getAttribute("content"))||null;return s||((s=document.createElement("meta")).setAttribute("name","robots"),document.head.appendChild(s)),s.setAttribute("content",e),()=>{let e=document.querySelector('meta[name="robots"]');e&&(t?e.setAttribute("content",t):e.remove())}},[])}}},e=>{e.O(0,[901,441,493,358],()=>e(e.s=8482)),_N_E=e.O()}]);