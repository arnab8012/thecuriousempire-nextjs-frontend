"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[901],{4901:(e,t,r)=>{r.d(t,{A:()=>g,O:()=>c});var l=r(5155),n=r(2115),a=r(4975),o=r(5167),u=r(6130);let i=(0,n.createContext)(null);function s(e){return(null==e?void 0:e._id)||(null==e?void 0:e.id)||(null==e?void 0:e.phone)||(null==e?void 0:e.email)||""}function c(e){let{children:t}=e,r=(0,o._)(),c=(0,u.r)(),[g,d]=(0,n.useState)(null),[m,v]=(0,n.useState)(!0);(0,n.useEffect)(()=>{let e=!0;return(async()=>{var t,l,n,o,u,i,g,m;try{let g=localStorage.getItem("token");if(!g){e&&(d(null),v(!1),null==r||null==(t=r.useUserCart)||t.call(r,""),null==c||null==(l=c.useUserFav)||l.call(c,""));return}let m=await a.F.getAuth("/api/auth/me",g);if(!e)return;if(null==m?void 0:m.ok){let e=m.user||null;d(e);let t=s(e);null==r||null==(n=r.useUserCart)||n.call(r,t),null==c||null==(o=c.useUserFav)||o.call(c,t)}else localStorage.removeItem("token"),d(null),null==r||null==(u=r.useUserCart)||u.call(r,""),null==c||null==(i=c.useUserFav)||i.call(c,"")}catch(t){e&&(localStorage.removeItem("token"),d(null),null==r||null==(g=r.useUserCart)||g.call(r,""),null==c||null==(m=c.useUserFav)||m.call(c,""))}finally{e&&v(!1)}})(),()=>{e=!1}},[]);let h=async(e,t)=>{var l,n;let o=await a.F.post("/api/auth/login",{phone:e,password:t});if(!(null==o?void 0:o.ok))return o;localStorage.setItem("token",o.token);let u=await a.F.getAuth("/api/auth/me",o.token),i=(null==u?void 0:u.ok)?u.user:o.user||null;d(i);let g=s(i)||e;return null==r||null==(l=r.useUserCart)||l.call(r,g),null==c||null==(n=c.useUserFav)||n.call(c,g),v(!1),{ok:!0,user:i}},y=async e=>{var t,l;let{fullName:n,phone:o,password:u,gender:i}=e,g=await a.F.post("/api/auth/register",{fullName:n,phone:o,password:u,gender:i});if(!(null==g?void 0:g.ok))return g;g.token&&localStorage.setItem("token",g.token);let m=g.user||null;d(m);let h=s(m)||o;return null==r||null==(t=r.useUserCart)||t.call(r,h),null==c||null==(l=c.useUserFav)||l.call(c,h),v(!1),{ok:!0,user:m}},S=async()=>{var e,t;let l=localStorage.getItem("token");if(!l)return{ok:!1,message:"No token"};let n=await a.F.getAuth("/api/auth/me",l);if(!(null==n?void 0:n.ok))return n;let o=n.user||null;d(o);let u=s(o);return null==r||null==(e=r.useUserCart)||e.call(r,u),null==c||null==(t=c.useUserFav)||t.call(c,u),{ok:!0,user:o}},p=async e=>{var t,l;let n=localStorage.getItem("token");if(!n)return{ok:!1,message:"No token"};let o=await a.F.putAuth("/api/auth/me",n,e);if(!(null==o?void 0:o.ok))return o;let u=o.user||null;d(u);let i=s(u);return null==r||null==(t=r.useUserCart)||t.call(r,i),null==c||null==(l=c.useUserFav)||l.call(c,i),{ok:!0,user:u}},f=async(e,t,r)=>await a.F.post("/api/auth/reset-password",{phone:e,fullName:t,newPassword:r});return(0,l.jsx)(i.Provider,{value:{user:g,booting:m,login:h,register:y,logout:()=>{var e,t;localStorage.removeItem("token"),d(null),v(!1),null==r||null==(e=r.useUserCart)||e.call(r,""),null==c||null==(t=c.useUserFav)||t.call(c,"")},refreshMe:S,updateMe:p,resetPassword:f},children:t})}function g(){return(0,n.useContext)(i)||{user:null,booting:!1,login:async()=>({ok:!1,message:"AuthProvider missing"}),register:async()=>({ok:!1,message:"AuthProvider missing"}),logout:()=>{},refreshMe:async()=>({ok:!1,message:"AuthProvider missing"}),updateMe:async()=>({ok:!1,message:"AuthProvider missing"}),resetPassword:async()=>({ok:!1,message:"AuthProvider missing"})}}},4975:(e,t,r)=>{r.d(t,{F:()=>a});let l=String("https://ecom-backend-rql0.onrender.com").replace(/\/$/,"");async function n(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};try{let r=await fetch(e,{...t,credentials:"include"}),l=await r.text(),n={};try{n=l?JSON.parse(l):{}}catch(e){n={ok:!1,message:l||"Non-JSON response"}}return r.ok||!n||"object"!=typeof n||"status"in n||(n.status=r.status),n}catch(e){return{ok:!1,message:(null==e?void 0:e.message)||"Network error"}}}let a={BASE:l,get:e=>n("".concat(l).concat(e),{method:"GET"}),getAuth:(e,t)=>n("".concat(l).concat(e),{method:"GET",headers:t?{Authorization:"Bearer ".concat(t)}:{}}),post:(e,t,r)=>n("".concat(l).concat(e),{method:"POST",headers:{"Content-Type":"application/json",...r?{Authorization:"Bearer ".concat(r)}:{}},body:JSON.stringify(t||{})}),postForm:(e,t,r)=>n("".concat(l).concat(e),{method:"POST",headers:{...r?{Authorization:"Bearer ".concat(r)}:{}},body:t}),postAuth:(e,t,r)=>n("".concat(l).concat(e),{method:"POST",headers:{"Content-Type":"application/json",...t?{Authorization:"Bearer ".concat(t)}:{}},body:JSON.stringify(r||{})}),put:(e,t,r)=>n("".concat(l).concat(e),{method:"PUT",headers:{"Content-Type":"application/json",...r?{Authorization:"Bearer ".concat(r)}:{}},body:JSON.stringify(t||{})}),putAuth:(e,t,r)=>n("".concat(l).concat(e),{method:"PUT",headers:{"Content-Type":"application/json",...t?{Authorization:"Bearer ".concat(t)}:{}},body:JSON.stringify(r||{})}),delete:(e,t)=>n("".concat(l).concat(e),{method:"DELETE",headers:t?{Authorization:"Bearer ".concat(t)}:{}}),token:function(){return localStorage.getItem("token")||""},adminToken:function(){return localStorage.getItem("admin_token")||""}}},5167:(e,t,r)=>{r.d(t,{_:()=>g,e:()=>c});var l=r(5155),n=r(2115);let a=(0,n.createContext)(null),o="cart_items_v1",u="buy_now_item_v1";function i(){try{let e=JSON.parse(localStorage.getItem("cart_items_v1")||"[]");return Array.isArray(e)?e:[]}catch(e){return[]}}function s(e){localStorage.setItem(o,JSON.stringify(e))}function c(e){let{children:t}=e,[r,c]=(0,n.useState)(i),[g,d]=(0,n.useState)(()=>{try{return JSON.parse(localStorage.getItem(u)||"null")}catch(e){return null}}),m=(0,n.useMemo)(()=>r.reduce((e,t)=>e+(t.qty||0),0),[r]);return(0,l.jsx)(a.Provider,{value:{items:r,add:e=>{c(t=>{let r,l=t.findIndex(t=>t.productId===e.productId&&String(t.variant||"")===String(e.variant||""));return s(r=l>=0?t.map((t,r)=>r===l?{...t,qty:Number(t.qty||0)+Number(e.qty||0)}:t):[...t,{...e,qty:Number(e.qty||1)}]),r})},inc:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";c(r=>{let l=r.map(r=>String(r.productId)!==String(e)||String(r.variant||"")!==String(t||"")?r:{...r,qty:Number(r.qty||0)+1});return s(l),l})},dec:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";c(r=>{let l=r.map(r=>String(r.productId)!==String(e)||String(r.variant||"")!==String(t||"")?r:{...r,qty:Math.max(1,Number(r.qty||0)-1)});return s(l),l})},remove:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";c(r=>{let l=r.filter(r=>String(r.productId)!==String(e)||String(r.variant||"")!==String(t||""));return s(l),l})},clear:()=>{c([]),localStorage.removeItem(o)},cartCount:m,buyNow:function(e){var t;let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,n={productId:e._id,title:e.title,price:e.price,image:(null==(t=e.images)?void 0:t[0])||e.image||"https://via.placeholder.com/300",variant:r,qty:l};d(n),localStorage.setItem(u,JSON.stringify(n))},checkoutItem:g,clearBuyNow:()=>{d(null),localStorage.removeItem(u)}},children:t})}function g(){return(0,n.useContext)(a)||{items:[],add:()=>{},inc:()=>{},dec:()=>{},remove:()=>{},clear:()=>{},cartCount:0,buyNow:()=>{},checkoutItem:null,clearBuyNow:()=>{},useUserCart:()=>{}}}},6130:(e,t,r)=>{r.d(t,{H:()=>i,r:()=>s});var l=r(5155),n=r(2115);let a=(0,n.createContext)(null),o="fav_guest";function u(e,t){try{let r=window.localStorage.getItem(e);return r?function(e,t){try{let r=JSON.parse(e);return null!=r?r:t}catch(e){return t}}(r,t):t}catch(e){return t}}function i(e){let{children:t}=e,[r,i]=(0,n.useState)(o),[s,c]=(0,n.useState)(()=>{let e=u(o,[]);return Array.isArray(e)?e:[]});(0,n.useEffect)(()=>{try{window.localStorage.setItem(r,JSON.stringify(s))}catch(e){}},[s,r]);let g=e=>{let t=String(e||"").trim();if(!t){i(o);let e=u(o,[]);c(Array.isArray(e)?e:[]);return}let r="fav_user_".concat(String(t||"").trim());i(r);let l=u(r,[]);c(Array.isArray(l)?l:[])},d=(0,n.useMemo)(()=>({favIds:s,useUserFav:g,isFav:e=>s.includes(String(e)),toggle(e){let t=String(e);c(e=>e.includes(t)?e.filter(e=>e!==t):[...e,t])},remove(e){let t=String(e);c(e=>e.filter(e=>e!==t))},clear(){c([])}}),[s]);return(0,l.jsx)(a.Provider,{value:d,children:t})}function s(){return(0,n.useContext)(a)||{favIds:[],toggle:()=>{},remove:()=>{},clear:()=>{},useUserFav:()=>{}}}}}]);